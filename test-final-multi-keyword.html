<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最终测试 - 多关键词搜索功能</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2 {
            color: #333;
        }
        .test-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .test-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .full-width {
            grid-column: 1 / -1;
        }
        .test-case {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
        }
        .test-button {
            background-color: #E9B949;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            font-weight: 500;
        }
        .test-button:hover {
            background-color: #d4a543;
        }
        .result {
            margin-top: 10px;
            padding: 15px;
            border-radius: 6px;
            background-color: #e8f5e9;
            border: 1px solid #4CAF50;
        }
        .error {
            background-color: #ffebee;
            border: 1px solid #f44336;
        }
        .keyword {
            display: inline-block;
            padding: 4px 12px;
            margin: 2px;
            background-color: #2196F3;
            color: white;
            border-radius: 16px;
            font-size: 14px;
        }
        .input-group {
            margin: 15px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 10px;
        }
        .status.success {
            background-color: #4CAF50;
            color: white;
        }
        .status.error {
            background-color: #f44336;
            color: white;
        }
        .method-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            background-color: #ff9800;
            color: white;
            margin-left: 5px;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>🧪 法考助手 - 多关键词搜索功能最终测试</h1>
    
    <div class="test-container">
        <!-- 测试场景 -->
        <div class="test-section full-width">
            <h2>📋 测试场景</h2>
            <div class="test-case">
                <h3>场景1：单个精确法律术语</h3>
                <p>问题：什么是有偿合同？</p>
                <p>期望结果：提取"有偿合同"</p>
                <button class="test-button" onclick="testScenario1()">测试场景1</button>
                <div id="scenario1Result"></div>
            </div>
            
            <div class="test-case">
                <h3>场景2：多个法律概念对比</h3>
                <p>问题：实践合同和诺成合同的区别是什么？</p>
                <p>期望结果：提取"实践合同"和"诺成合同"</p>
                <button class="test-button" onclick="testScenario2()">测试场景2</button>
                <div id="scenario2Result"></div>
            </div>
            
            <div class="test-case">
                <h3>场景3：复杂的多概念问题</h3>
                <p>问题：正当防卫、紧急避险和犯罪构成之间的关系如何理解？</p>
                <p>期望结果：提取"正当防卫"、"紧急避险"和"犯罪构成"</p>
                <button class="test-button" onclick="testScenario3()">测试场景3</button>
                <div id="scenario3Result"></div>
            </div>
            
            <div class="test-case">
                <h3>场景4：模糊问题的智能提取</h3>
                <p>问题：离婚时财产如何分割，子女抚养权归谁？</p>
                <p>期望结果：智能提取相关法律概念</p>
                <button class="test-button" onclick="testScenario4()">测试场景4</button>
                <div id="scenario4Result"></div>
            </div>
        </div>
        
        <!-- 导图跳转测试 -->
        <div class="test-section">
            <h2>🗺️ 导图跳转测试</h2>
            <button class="test-button" onclick="testMindMapSingle()">单个关键词跳转</button>
            <button class="test-button" onclick="testMindMapMultiple()">多个关键词跳转</button>
            <button class="test-button" onclick="testMindMapComplex()">复杂关键词跳转</button>
            <div id="mindMapResult"></div>
        </div>
        
        <!-- API测试 -->
        <div class="test-section">
            <h2>🔌 API响应测试</h2>
            <button class="test-button" onclick="testAPIResponse()">测试API响应</button>
            <div id="apiResult"></div>
        </div>
        
        <!-- 自定义测试 -->
        <div class="test-section full-width">
            <h2>✏️ 自定义测试</h2>
            <div class="input-group">
                <label>输入法律问题：</label>
                <textarea id="customQuestion" placeholder="例如：承揽合同和委托合同有什么区别？"></textarea>
            </div>
            <div class="input-group">
                <label>AI回答（可选）：</label>
                <textarea id="customAnswer" placeholder="可以输入AI的回答内容，帮助更精确地提取关键词"></textarea>
            </div>
            <div>
                <button class="test-button" onclick="testCustomSingle()">提取单个关键词</button>
                <button class="test-button" onclick="testCustomMultiple()">提取多个关键词</button>
            </div>
            <div id="customResult"></div>
        </div>
        
        <!-- 批量测试 -->
        <div class="test-section full-width">
            <h2>🚀 批量测试</h2>
            <button class="test-button" onclick="runAllTests()">运行所有测试</button>
            <div id="batchResult"></div>
        </div>
    </div>

    <script>
        // API调用函数
        async function extractKeywords(question, answer = '', multipleKeywords = false) {
            const startTime = performance.now();
            try {
                const response = await fetch('/api/ai/extract-single-keyword', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        question: question,
                        answer: answer,
                        multipleKeywords: multipleKeywords
                    })
                });
                
                const data = await response.json();
                const endTime = performance.now();
                data.responseTime = (endTime - startTime).toFixed(2);
                return data;
            } catch (error) {
                console.error('提取关键词失败:', error);
                return { 
                    success: false, 
                    message: error.message,
                    responseTime: 0
                };
            }
        }
        
        // 显示结果函数
        function displayResult(elementId, result, expectedKeywords = []) {
            const resultDiv = document.getElementById(elementId);
            let html = '';
            
            if (result.success) {
                html += `<div class="result">`;
                html += `<strong>✅ 提取成功</strong>`;
                html += `<span class="status success">成功</span>`;
                html += `<span class="method-tag">${result.method === 'ai' ? 'AI提取' : '规则提取'}</span><br>`;
                html += `<strong>响应时间：</strong>${result.responseTime}ms<br>`;
                
                if (result.keywords && result.keywords.length > 0) {
                    html += '<strong>提取的关键词：</strong>';
                    result.keywords.forEach(keyword => {
                        html += `<span class="keyword">${keyword}</span>`;
                    });
                } else if (result.keyword) {
                    html += `<strong>提取的关键词：</strong><span class="keyword">${result.keyword}</span>`;
                }
                
                if (expectedKeywords.length > 0) {
                    html += '<br><strong>期望的关键词：</strong>';
                    expectedKeywords.forEach(keyword => {
                        html += `<span class="keyword" style="background-color: #4CAF50;">${keyword}</span>`;
                    });
                }
                
                html += `</div>`;
            } else {
                html += `<div class="result error">`;
                html += `<strong>❌ 提取失败</strong>`;
                html += `<span class="status error">失败</span><br>`;
                html += `<strong>错误信息：</strong>${result.message || '未知错误'}`;
                html += `</div>`;
            }
            
            resultDiv.innerHTML = html;
        }
        
        // 测试场景函数
        async function testScenario1() {
            const result = await extractKeywords('什么是有偿合同？', '', false);
            displayResult('scenario1Result', result, ['有偿合同']);
        }
        
        async function testScenario2() {
            const result = await extractKeywords('实践合同和诺成合同的区别是什么？', '', true);
            displayResult('scenario2Result', result, ['实践合同', '诺成合同']);
        }
        
        async function testScenario3() {
            const result = await extractKeywords('正当防卫、紧急避险和犯罪构成之间的关系如何理解？', '', true);
            displayResult('scenario3Result', result, ['正当防卫', '紧急避险', '犯罪构成']);
        }
        
        async function testScenario4() {
            const result = await extractKeywords('离婚时财产如何分割，子女抚养权归谁？', '', true);
            displayResult('scenario4Result', result, ['财产分割', '子女抚养权']);
        }
        
        // 导图跳转测试
        function testMindMapSingle() {
            const url = `/knowledge-map?subject=civil&search=有偿合同`;
            showMindMapResult('单个关键词', url);
        }
        
        function testMindMapMultiple() {
            const url = `/knowledge-map?subject=civil&search=实践合同,诺成合同`;
            showMindMapResult('多个关键词', url);
        }
        
        function testMindMapComplex() {
            const url = `/knowledge-map?subject=criminal&search=正当防卫,紧急避险,犯罪构成`;
            showMindMapResult('复杂关键词', url);
        }
        
        function showMindMapResult(type, url) {
            const resultDiv = document.getElementById('mindMapResult');
            resultDiv.innerHTML = `
                <div class="result">
                    <strong>🔗 ${type}跳转URL：</strong><br>
                    <pre>${url}</pre>
                    <button class="test-button" onclick="window.open('${url}', '_blank')">在新窗口打开</button>
                </div>
            `;
        }
        
        // API响应测试
        async function testAPIResponse() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = '<div class="result">正在测试API响应...</div>';
            
            const testCases = [
                { question: '合同的保全', multiple: false },
                { question: '承揽合同的特征', multiple: false },
                { question: '买卖合同和赠与合同的区别', multiple: true },
            ];
            
            let html = '<div class="result">';
            for (const testCase of testCases) {
                const result = await extractKeywords(testCase.question, '', testCase.multiple);
                html += `<strong>问题：</strong>${testCase.question}<br>`;
                html += `<strong>状态：</strong>${result.success ? '✅ 成功' : '❌ 失败'}<br>`;
                html += `<strong>方法：</strong>${result.method || 'N/A'}<br>`;
                html += `<strong>结果：</strong>${result.keywords ? result.keywords.join(', ') : result.keyword}<br>`;
                html += `<strong>响应时间：</strong>${result.responseTime}ms<br><hr>`;
            }
            html += '</div>';
            
            resultDiv.innerHTML = html;
        }
        
        // 自定义测试
        async function testCustomSingle() {
            const question = document.getElementById('customQuestion').value;
            const answer = document.getElementById('customAnswer').value;
            if (!question) {
                alert('请输入问题');
                return;
            }
            const result = await extractKeywords(question, answer, false);
            displayResult('customResult', result);
        }
        
        async function testCustomMultiple() {
            const question = document.getElementById('customQuestion').value;
            const answer = document.getElementById('customAnswer').value;
            if (!question) {
                alert('请输入问题');
                return;
            }
            const result = await extractKeywords(question, answer, true);
            displayResult('customResult', result);
        }
        
        // 批量测试
        async function runAllTests() {
            const resultDiv = document.getElementById('batchResult');
            resultDiv.innerHTML = '<div class="result">正在运行所有测试...</div>';
            
            const tests = [
                testScenario1(),
                testScenario2(),
                testScenario3(),
                testScenario4(),
                testAPIResponse()
            ];
            
            await Promise.all(tests);
            
            resultDiv.innerHTML = '<div class="result"><strong>✅ 所有测试完成！</strong>请查看各个测试结果。</div>';
        }
    </script>
</body>
</html>