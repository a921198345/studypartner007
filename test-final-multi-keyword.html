<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ç»ˆæµ‹è¯• - å¤šå…³é”®è¯æœç´¢åŠŸèƒ½</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2 {
            color: #333;
        }
        .test-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .test-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .full-width {
            grid-column: 1 / -1;
        }
        .test-case {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
        }
        .test-button {
            background-color: #E9B949;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            font-weight: 500;
        }
        .test-button:hover {
            background-color: #d4a543;
        }
        .result {
            margin-top: 10px;
            padding: 15px;
            border-radius: 6px;
            background-color: #e8f5e9;
            border: 1px solid #4CAF50;
        }
        .error {
            background-color: #ffebee;
            border: 1px solid #f44336;
        }
        .keyword {
            display: inline-block;
            padding: 4px 12px;
            margin: 2px;
            background-color: #2196F3;
            color: white;
            border-radius: 16px;
            font-size: 14px;
        }
        .input-group {
            margin: 15px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 10px;
        }
        .status.success {
            background-color: #4CAF50;
            color: white;
        }
        .status.error {
            background-color: #f44336;
            color: white;
        }
        .method-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            background-color: #ff9800;
            color: white;
            margin-left: 5px;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ³•è€ƒåŠ©æ‰‹ - å¤šå…³é”®è¯æœç´¢åŠŸèƒ½æœ€ç»ˆæµ‹è¯•</h1>
    
    <div class="test-container">
        <!-- æµ‹è¯•åœºæ™¯ -->
        <div class="test-section full-width">
            <h2>ğŸ“‹ æµ‹è¯•åœºæ™¯</h2>
            <div class="test-case">
                <h3>åœºæ™¯1ï¼šå•ä¸ªç²¾ç¡®æ³•å¾‹æœ¯è¯­</h3>
                <p>é—®é¢˜ï¼šä»€ä¹ˆæ˜¯æœ‰å¿åˆåŒï¼Ÿ</p>
                <p>æœŸæœ›ç»“æœï¼šæå–"æœ‰å¿åˆåŒ"</p>
                <button class="test-button" onclick="testScenario1()">æµ‹è¯•åœºæ™¯1</button>
                <div id="scenario1Result"></div>
            </div>
            
            <div class="test-case">
                <h3>åœºæ™¯2ï¼šå¤šä¸ªæ³•å¾‹æ¦‚å¿µå¯¹æ¯”</h3>
                <p>é—®é¢˜ï¼šå®è·µåˆåŒå’Œè¯ºæˆåˆåŒçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>
                <p>æœŸæœ›ç»“æœï¼šæå–"å®è·µåˆåŒ"å’Œ"è¯ºæˆåˆåŒ"</p>
                <button class="test-button" onclick="testScenario2()">æµ‹è¯•åœºæ™¯2</button>
                <div id="scenario2Result"></div>
            </div>
            
            <div class="test-case">
                <h3>åœºæ™¯3ï¼šå¤æ‚çš„å¤šæ¦‚å¿µé—®é¢˜</h3>
                <p>é—®é¢˜ï¼šæ­£å½“é˜²å«ã€ç´§æ€¥é¿é™©å’ŒçŠ¯ç½ªæ„æˆä¹‹é—´çš„å…³ç³»å¦‚ä½•ç†è§£ï¼Ÿ</p>
                <p>æœŸæœ›ç»“æœï¼šæå–"æ­£å½“é˜²å«"ã€"ç´§æ€¥é¿é™©"å’Œ"çŠ¯ç½ªæ„æˆ"</p>
                <button class="test-button" onclick="testScenario3()">æµ‹è¯•åœºæ™¯3</button>
                <div id="scenario3Result"></div>
            </div>
            
            <div class="test-case">
                <h3>åœºæ™¯4ï¼šæ¨¡ç³Šé—®é¢˜çš„æ™ºèƒ½æå–</h3>
                <p>é—®é¢˜ï¼šç¦»å©šæ—¶è´¢äº§å¦‚ä½•åˆ†å‰²ï¼Œå­å¥³æŠšå…»æƒå½’è°ï¼Ÿ</p>
                <p>æœŸæœ›ç»“æœï¼šæ™ºèƒ½æå–ç›¸å…³æ³•å¾‹æ¦‚å¿µ</p>
                <button class="test-button" onclick="testScenario4()">æµ‹è¯•åœºæ™¯4</button>
                <div id="scenario4Result"></div>
            </div>
        </div>
        
        <!-- å¯¼å›¾è·³è½¬æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ—ºï¸ å¯¼å›¾è·³è½¬æµ‹è¯•</h2>
            <button class="test-button" onclick="testMindMapSingle()">å•ä¸ªå…³é”®è¯è·³è½¬</button>
            <button class="test-button" onclick="testMindMapMultiple()">å¤šä¸ªå…³é”®è¯è·³è½¬</button>
            <button class="test-button" onclick="testMindMapComplex()">å¤æ‚å…³é”®è¯è·³è½¬</button>
            <div id="mindMapResult"></div>
        </div>
        
        <!-- APIæµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”Œ APIå“åº”æµ‹è¯•</h2>
            <button class="test-button" onclick="testAPIResponse()">æµ‹è¯•APIå“åº”</button>
            <div id="apiResult"></div>
        </div>
        
        <!-- è‡ªå®šä¹‰æµ‹è¯• -->
        <div class="test-section full-width">
            <h2>âœï¸ è‡ªå®šä¹‰æµ‹è¯•</h2>
            <div class="input-group">
                <label>è¾“å…¥æ³•å¾‹é—®é¢˜ï¼š</label>
                <textarea id="customQuestion" placeholder="ä¾‹å¦‚ï¼šæ‰¿æ½åˆåŒå’Œå§”æ‰˜åˆåŒæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></textarea>
            </div>
            <div class="input-group">
                <label>AIå›ç­”ï¼ˆå¯é€‰ï¼‰ï¼š</label>
                <textarea id="customAnswer" placeholder="å¯ä»¥è¾“å…¥AIçš„å›ç­”å†…å®¹ï¼Œå¸®åŠ©æ›´ç²¾ç¡®åœ°æå–å…³é”®è¯"></textarea>
            </div>
            <div>
                <button class="test-button" onclick="testCustomSingle()">æå–å•ä¸ªå…³é”®è¯</button>
                <button class="test-button" onclick="testCustomMultiple()">æå–å¤šä¸ªå…³é”®è¯</button>
            </div>
            <div id="customResult"></div>
        </div>
        
        <!-- æ‰¹é‡æµ‹è¯• -->
        <div class="test-section full-width">
            <h2>ğŸš€ æ‰¹é‡æµ‹è¯•</h2>
            <button class="test-button" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <div id="batchResult"></div>
        </div>
    </div>

    <script>
        // APIè°ƒç”¨å‡½æ•°
        async function extractKeywords(question, answer = '', multipleKeywords = false) {
            const startTime = performance.now();
            try {
                const response = await fetch('/api/ai/extract-single-keyword', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        question: question,
                        answer: answer,
                        multipleKeywords: multipleKeywords
                    })
                });
                
                const data = await response.json();
                const endTime = performance.now();
                data.responseTime = (endTime - startTime).toFixed(2);
                return data;
            } catch (error) {
                console.error('æå–å…³é”®è¯å¤±è´¥:', error);
                return { 
                    success: false, 
                    message: error.message,
                    responseTime: 0
                };
            }
        }
        
        // æ˜¾ç¤ºç»“æœå‡½æ•°
        function displayResult(elementId, result, expectedKeywords = []) {
            const resultDiv = document.getElementById(elementId);
            let html = '';
            
            if (result.success) {
                html += `<div class="result">`;
                html += `<strong>âœ… æå–æˆåŠŸ</strong>`;
                html += `<span class="status success">æˆåŠŸ</span>`;
                html += `<span class="method-tag">${result.method === 'ai' ? 'AIæå–' : 'è§„åˆ™æå–'}</span><br>`;
                html += `<strong>å“åº”æ—¶é—´ï¼š</strong>${result.responseTime}ms<br>`;
                
                if (result.keywords && result.keywords.length > 0) {
                    html += '<strong>æå–çš„å…³é”®è¯ï¼š</strong>';
                    result.keywords.forEach(keyword => {
                        html += `<span class="keyword">${keyword}</span>`;
                    });
                } else if (result.keyword) {
                    html += `<strong>æå–çš„å…³é”®è¯ï¼š</strong><span class="keyword">${result.keyword}</span>`;
                }
                
                if (expectedKeywords.length > 0) {
                    html += '<br><strong>æœŸæœ›çš„å…³é”®è¯ï¼š</strong>';
                    expectedKeywords.forEach(keyword => {
                        html += `<span class="keyword" style="background-color: #4CAF50;">${keyword}</span>`;
                    });
                }
                
                html += `</div>`;
            } else {
                html += `<div class="result error">`;
                html += `<strong>âŒ æå–å¤±è´¥</strong>`;
                html += `<span class="status error">å¤±è´¥</span><br>`;
                html += `<strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>${result.message || 'æœªçŸ¥é”™è¯¯'}`;
                html += `</div>`;
            }
            
            resultDiv.innerHTML = html;
        }
        
        // æµ‹è¯•åœºæ™¯å‡½æ•°
        async function testScenario1() {
            const result = await extractKeywords('ä»€ä¹ˆæ˜¯æœ‰å¿åˆåŒï¼Ÿ', '', false);
            displayResult('scenario1Result', result, ['æœ‰å¿åˆåŒ']);
        }
        
        async function testScenario2() {
            const result = await extractKeywords('å®è·µåˆåŒå’Œè¯ºæˆåˆåŒçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ', '', true);
            displayResult('scenario2Result', result, ['å®è·µåˆåŒ', 'è¯ºæˆåˆåŒ']);
        }
        
        async function testScenario3() {
            const result = await extractKeywords('æ­£å½“é˜²å«ã€ç´§æ€¥é¿é™©å’ŒçŠ¯ç½ªæ„æˆä¹‹é—´çš„å…³ç³»å¦‚ä½•ç†è§£ï¼Ÿ', '', true);
            displayResult('scenario3Result', result, ['æ­£å½“é˜²å«', 'ç´§æ€¥é¿é™©', 'çŠ¯ç½ªæ„æˆ']);
        }
        
        async function testScenario4() {
            const result = await extractKeywords('ç¦»å©šæ—¶è´¢äº§å¦‚ä½•åˆ†å‰²ï¼Œå­å¥³æŠšå…»æƒå½’è°ï¼Ÿ', '', true);
            displayResult('scenario4Result', result, ['è´¢äº§åˆ†å‰²', 'å­å¥³æŠšå…»æƒ']);
        }
        
        // å¯¼å›¾è·³è½¬æµ‹è¯•
        function testMindMapSingle() {
            const url = `/knowledge-map?subject=civil&search=æœ‰å¿åˆåŒ`;
            showMindMapResult('å•ä¸ªå…³é”®è¯', url);
        }
        
        function testMindMapMultiple() {
            const url = `/knowledge-map?subject=civil&search=å®è·µåˆåŒ,è¯ºæˆåˆåŒ`;
            showMindMapResult('å¤šä¸ªå…³é”®è¯', url);
        }
        
        function testMindMapComplex() {
            const url = `/knowledge-map?subject=criminal&search=æ­£å½“é˜²å«,ç´§æ€¥é¿é™©,çŠ¯ç½ªæ„æˆ`;
            showMindMapResult('å¤æ‚å…³é”®è¯', url);
        }
        
        function showMindMapResult(type, url) {
            const resultDiv = document.getElementById('mindMapResult');
            resultDiv.innerHTML = `
                <div class="result">
                    <strong>ğŸ”— ${type}è·³è½¬URLï¼š</strong><br>
                    <pre>${url}</pre>
                    <button class="test-button" onclick="window.open('${url}', '_blank')">åœ¨æ–°çª—å£æ‰“å¼€</button>
                </div>
            `;
        }
        
        // APIå“åº”æµ‹è¯•
        async function testAPIResponse() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = '<div class="result">æ­£åœ¨æµ‹è¯•APIå“åº”...</div>';
            
            const testCases = [
                { question: 'åˆåŒçš„ä¿å…¨', multiple: false },
                { question: 'æ‰¿æ½åˆåŒçš„ç‰¹å¾', multiple: false },
                { question: 'ä¹°å–åˆåŒå’Œèµ ä¸åˆåŒçš„åŒºåˆ«', multiple: true },
            ];
            
            let html = '<div class="result">';
            for (const testCase of testCases) {
                const result = await extractKeywords(testCase.question, '', testCase.multiple);
                html += `<strong>é—®é¢˜ï¼š</strong>${testCase.question}<br>`;
                html += `<strong>çŠ¶æ€ï¼š</strong>${result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}<br>`;
                html += `<strong>æ–¹æ³•ï¼š</strong>${result.method || 'N/A'}<br>`;
                html += `<strong>ç»“æœï¼š</strong>${result.keywords ? result.keywords.join(', ') : result.keyword}<br>`;
                html += `<strong>å“åº”æ—¶é—´ï¼š</strong>${result.responseTime}ms<br><hr>`;
            }
            html += '</div>';
            
            resultDiv.innerHTML = html;
        }
        
        // è‡ªå®šä¹‰æµ‹è¯•
        async function testCustomSingle() {
            const question = document.getElementById('customQuestion').value;
            const answer = document.getElementById('customAnswer').value;
            if (!question) {
                alert('è¯·è¾“å…¥é—®é¢˜');
                return;
            }
            const result = await extractKeywords(question, answer, false);
            displayResult('customResult', result);
        }
        
        async function testCustomMultiple() {
            const question = document.getElementById('customQuestion').value;
            const answer = document.getElementById('customAnswer').value;
            if (!question) {
                alert('è¯·è¾“å…¥é—®é¢˜');
                return;
            }
            const result = await extractKeywords(question, answer, true);
            displayResult('customResult', result);
        }
        
        // æ‰¹é‡æµ‹è¯•
        async function runAllTests() {
            const resultDiv = document.getElementById('batchResult');
            resultDiv.innerHTML = '<div class="result">æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...</div>';
            
            const tests = [
                testScenario1(),
                testScenario2(),
                testScenario3(),
                testScenario4(),
                testAPIResponse()
            ];
            
            await Promise.all(tests);
            
            resultDiv.innerHTML = '<div class="result"><strong>âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆï¼</strong>è¯·æŸ¥çœ‹å„ä¸ªæµ‹è¯•ç»“æœã€‚</div>';
        }
    </script>
</body>
</html>