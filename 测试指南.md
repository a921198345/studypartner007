# 法律文档智能处理系统测试指南

本指南将帮助您测试法律文档智能处理系统的各项功能，包括文档上传、文本提取、文本分段、向量化和向量检索功能。

## 1. 环境准备

### 1.1 安装必要依赖

```bash
# 进入项目目录
cd law-exam-assistant

# 安装依赖
chmod +x setup_vector_db.sh
./setup_vector_db.sh
```

### 1.2 设置API密钥

为了使用DeepSeek API进行向量嵌入生成，需要设置API密钥：

```bash
export DEEPSEEK_API_KEY=你的API密钥
```

### 1.3 启动API服务

```bash
# 激活虚拟环境
source venv_flask_api/bin/activate

# 启动API服务
python admin_api.py
```

## 2. 功能测试流程

### 2.1 文档上传测试

1. 打开浏览器访问 `http://localhost:5003/upload_test.html`
2. 选择"文档上传"选项卡
3. 点击"选择文件"按钮，选择一个Word格式的法律文档（如`宪法.docx`）
4. 点击"上传文档"按钮
5. 上传成功后，会返回文档ID，请记录这个ID用于后续步骤

### 2.2 文本提取测试

1. 在`upload_test.html`页面中选择"文本提取"选项卡
2. 输入上一步中获得的文档ID
3. 点击"提取文本"按钮
4. 查看提取的文本内容，确认文本已正确提取

### 2.3 文本分段测试

1. 在`upload_test.html`页面中选择"文本分段"选项卡
2. 选择"法律结构"分段策略
3. 输入上一步获得的文档ID，或直接复制提取的文本内容
4. 设置分段大小（建议值：800）
5. 点击"分段处理"按钮
6. 查看分段结果，确认法律结构（编、章、节、条等）被正确识别

### 2.4 专用法律分段测试页面

1. 打开浏览器访问 `http://localhost:5003/test_legal_segmentation.html`
2. 点击"加载示例文本"按钮，或粘贴您自己的法律文本
3. 点击"执行法律结构分段"按钮
4. 查看分段结果，确认法律文档结构被正确识别和分段

### 2.5 文档向量化测试

1. 打开浏览器访问 `http://localhost:5003/test_vector_search.html`
2. 在"文档向量化处理"部分，输入之前获得的文档ID
3. 设置分段大小（建议值：800）
4. 点击"执行向量化处理"按钮
5. 等待处理完成，确认向量化成功

### 2.6 向量检索测试

1. 在`test_vector_search.html`页面的"向量检索"部分
2. 输入一个搜索查询，如"公民的基本权利有哪些"
3. 设置结果数量（默认5）
4. 可以点击"显示高级过滤"来添加过滤条件（如法律名称或条文）
5. 点击"执行检索"按钮
6. 查看检索结果，确认返回了相关的法律条文

## 3. 常见问题解决方案

### 3.1 API服务无法启动

**问题描述**：运行`python admin_api.py`时出现错误

**解决方案**：
1. 确保已激活虚拟环境：`source venv_flask_api/bin/activate`
2. 检查所有依赖是否已安装：`pip install flask flask-cors python-docx requests numpy`
3. 确保端口5003未被占用：`lsof -i :5003`，如果被占用，可以终止占用进程或修改端口

### 3.2 文本分段失败

**问题描述**：分段处理时显示"分段处理失败：文本分段模块未正确加载"

**解决方案**：
1. 确保`text_segmentation.py`文件存在且包含所需的分段函数
2. 重新启动API服务：先`pkill -f "python admin_api.py"`，然后重新运行`python admin_api.py`

### 3.3 向量化处理失败

**问题描述**：执行向量化处理时显示"向量化存储失败"或"向量存储模块未加载"

**解决方案**：
1. 确保已设置DeepSeek API密钥：`export DEEPSEEK_API_KEY=你的API密钥`
2. 检查`vector_store.py`文件是否存在且正确实现
3. 检查网络连接是否正常，DeepSeek API是否可访问
4. 检查数据库连接配置是否正确

### 3.4 数据库连接失败

**问题描述**：系统无法连接到MySQL数据库

**解决方案**：
1. 检查MySQL连接参数是否正确（主机、用户名、密码、数据库名）
2. 确保MySQL服务器已启动且可访问
3. 如果使用宝塔面板，检查数据库权限设置
4. 系统会自动降级到SQLite数据库，可以检查`data/vector_store.db`文件是否已创建

### 3.5 DeepSeek API调用失败

**问题描述**：向量嵌入生成过程中出现API错误

**解决方案**：
1. 确认API密钥有效且已正确设置
2. 检查API请求限额是否已用完
3. 查看API服务状态是否正常

## 4. 后续开发建议

1. 集成更多类型的文档处理（如PDF、TXT等）
2. 优化分段算法，更准确地识别法律文档结构
3. 添加更多向量数据库选项（如Milvus、Qdrant等）
4. 实现用户数据隔离和权限控制
5. 添加更多统计和分析功能
6. 开发更好的向量检索前端界面
7. 添加搜索历史和用户偏好功能

通过以上测试步骤，您应该能够完整测试法律文档智能处理系统的各项功能。如果在测试过程中遇到任何问题，请参考"常见问题解决方案"部分或查阅系统文档。 