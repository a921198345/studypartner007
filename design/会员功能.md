# 会员功能说明

> 本文档用于阐述"学习搭子"平台在 **免费用户**（下称 *非会员*）与 **会员用户**（下称 *会员*）两种角色下的功能差异、使用限制及对应的提醒策略，供产品、设计及开发同学参考。

---

## 1. 功能对比总览

| 功能模块 | 非会员 | 会员 |
| -------- | ------ | ---- |
| 法考 AI 问答 | **每日 3 次**<br/>次日零点自动重置 | 不限次数 |
| 法考知识导图 | 仅可查看 **「民法」** 学科导图 | 查看全部 8 大学科导图 |
| 法考真题库 | 仅可访问 **2022 年**真题 | 访问全部年份真题 |
| 学习笔记 | 最多创建 **10 条** | 不限条数 |
| 学习计划 | **无限制** 使用 | 无限制，且享受 AI 督学、智能调整等高级特性 |

> 说明：表中未列出的其他功能（如个人中心、账号设置等）对所有用户开放，且无差异化限制。

---

## 2. 非会员功能与限制

1. **法考 AI 问答**
   - 每日可提问 *3* 次。
   - 后端通过 `user_daily_qa_count` 字段记录已用次数；零点定时任务重置。
2. **法考知识导图**
   - 仅开放「民法」学科的导图数据接口 (`/api/mindmaps/minfa`)。
   - 访问其他学科时返回 `403` 并触发升级提示。
3. **法考真题库**
   - 仅可拉取 `year = 2022` 的题目列表与详情。
   - 其余年份请求返回空列表并附带升级提示字段 `upgrade_required: true`。
4. **学习笔记**
   - 每个账户最多新建 *10* 条笔记 (`notes_count ≤ 10`)。
   - 超过限制时，前端弹窗提示"已达免费额度，升级即可无限创建笔记"。
5. **学习计划**
   - 功能完全开放，无次数或条目限制。
   - 会员仅在 AI 督学、智能计划调整等增强特性上享受更佳体验。

---

## 3. 提醒策略

### 3.1 注册 / 登录提醒

| 场景 | 触发时机 | 提示方式 |
| ---- | -------- | -------- |
| 首次使用任一受限功能（问答 / 知识导图 / 真题库 / 笔记 / 学习计划） | 当检测到用户未登录 | 非侵入式浮窗 + 遮罩层，提示"登录后可保存进度并享受更多服务"<br/>提供"立即登录 / 稍后再说"按钮 |

> *实现参考*：在前端统一封装 `requireAuth()` 方法；若 `!isLoggedIn` 则弹出登录组件并中断后续 API 调用。

### 3.2 升级会员提醒

| 场景 | 触发时机 | 提示方式 |
| ---- | -------- | -------- |
| 非会员用尽当日 3 次 AI 问答额度 | 提交第 4 次提问请求时 | 对话区域插入提示卡片 + 固定底部横幅，"升级会员即可无限提问" |
| 访问非「民法」知识导图 | 请求 `/api/mindmaps/xxx` 返回 403 时 | 导图页面弹窗遮罩 + 右侧价格卡 |
| 访问除 2022 年外的真题 | 请求 `/api/exams/questions?year=2023` 等被拒绝时 | 题库列表区域显示占位卡 + 升级按钮 |
| 创建第 11 条学习笔记 | 点击"保存"时 | 编辑器顶部 toast + 升级弹窗 |

---

## 4. 技术实现要点

1. **额度校验**：
   - 后端 `users` 表增加对应计数字段（如 `daily_qa_count INT`）。
   - 每次成功调用 AI 问答接口即 `+1`，并校验剩余额度。
2. **数据过滤**：
   - 知识导图、真题库 API 根据 `user.role` 决定查询范围。
3. **前端拦截器**：
   - 统一处理 `403 | 429` 等状态码，解析 `error_code = "UPGRADE_REQUIRED"`；
   - 调用 `showUpgradeModal()` 显示会员宣传页。
4. **零点重置**：
   - 可使用 `cron` 或计划任务在 UTC+8 每日 00:00 清空 `daily_qa_count`。

---

## 5. 版本与迭代

| 版本 | 日期 | 变更内容 |
| ---- | ---- | -------- |
| v1.0 | 2025-06-15 | 初版，新增非会员功能限制及提醒策略 |

---

### 附录：术语说明

- **AI 问答**：指平台基于 DeepSeek API 的"法考问答"功能。
- **知识导图**：指基于 OPML 数据渲染的法考树状知识结构图。
- **学习计划**：包含定制计划、打卡、AI 督学等子功能的组合。 