# 法考知识导图功能设计

## 功能描述

法考知识导图功能是"学习搭子"平台的核心特色之一，旨在通过结构化、可视化的树状图形式展示法考各学科的知识体系和脉络。用户可交互地浏览、展开或折叠知识点，探索法律概念间的逻辑关系。该功能支持与AI问答和真题库的智能联动，能够根据用户学习场景自动定位和高亮相关知识点，帮助用户构建完整的法学知识体系，提升学习效率。

## 功能实现流程

### 1. 知识导图内容准备流程

1. **专业内容编撰**：
   - 法学专家根据最新法考大纲和教材，梳理各科目知识点层级关系
   - 编撰结构化的OPML格式文档，确保知识点间的逻辑关系准确
   - 为每个知识点添加唯一标识符，便于后续与其他功能模块联动

2. **OPML文件上传与存储**：
   - 管理员通过后台管理界面上传编撰好的OPML文件
   - 系统验证OPML文件格式，支持1MB以上大文件上传
   - 将文件存储至服务器，数据库中记录文件路径和元数据
   - 支持版本管理，可上传更新版本的知识导图

3. **知识点索引建立**：
   - 系统解析OPML文件，提取所有知识点及其层级关系
   - 为每个知识点建立索引，存储其在导图中的位置、层级和关联信息
   - 将知识点文本向量化，便于与AI问答和真题库进行语义匹配

### 2. 知识导图展示流程

1. **用户访问导图**：
   - 用户选择需要查看的学科（如民法、刑法等）
   - 系统加载对应学科的知识导图数据
   - 校验用户权限，免费用户仅能访问"民法"学科

2. **导图渲染**：
   - 前端使用react-d3-tree库渲染树状结构
   - 默认仅展开至第三层知识点，减少初始加载压力
   - 应用统一的视觉样式，不同层级节点使用不同的视觉区分
   - 导图支持缩放、平移等基础操作

3. **交互响应**：
   - 用户点击节点时，展开或折叠该节点下的子节点
   - 展开折叠过程应用平滑动画，提升用户体验
   - 点击知识点后可显示该知识点的详细说明（如有）

### 3. 智能联动流程

1. **与AI问答联动**：
   - 用户在AI问答中得到回答后，点击"查看相关知识导图"
   - 系统分析AI回答内容，提取关键知识点
   - 在知识导图中定位这些知识点，并自动跳转到知识导图页面
   - 自动展开包含相关知识点的分支，高亮显示相关节点
   - 免费用户每日可使用两次AI问答的智能联动功能

2. **与真题库联动**：
   - 用户做题后查看解析，点击"查看相关知识导图"
   - 系统识别题目涉及的知识点（预先标记或实时分析）
   - 跳转至知识导图页面并定位到相关知识点
   - 展开相关分支并高亮显示

3. **数据反馈循环**：
   - 记录用户在导图中的浏览行为和重点关注区域
   - 分析用户学习模式，为个性化学习计划提供数据支持
   - 收集导图使用过程中的问题反馈，持续优化内容和结构

## 业务规则

### 1. 用户权限控制

- **免费用户**：
  - 仅可访问"民法"学科的知识导图
  - 尝试访问其他学科时提示升级会员
  - 每日可使用两次AI问答的智能联动功能
  - 可使用民法学科题目的智能联动功能，其他学科题目需升级会员

- **会员用户**：
  - 可访问所有学科的知识导图
  - 可使用完整的智能联动功能
  - 可查看知识点的详细解释（如果有）

### 2. 导图内容管理规则

- 导图内容应定期更新，确保与最新法考大纲一致
- 每次内容更新需保留历史版本，以便对比和回溯
- 新上传的导图版本需经过审核后才能正式发布
- 用户反馈的内容错误或优化建议应及时评估和处理

### 3. 性能与可用性规则

- 导图初始加载时间应控制在3秒内
- 节点展开/折叠操作响应时间应在500ms内
- 对于较大的知识导图，应实现渐进式加载，避免一次性加载全部内容
- 在弱网络环境下提供降级策略，确保基本可用性

## 使用角色

### 1. 普通用户

- **免费用户**：
  - 浏览"民法"学科知识导图
  - 基本的展开/折叠交互
  - 无智能联动权限

- **会员用户**：
  - 浏览所有学科知识导图
  - 完整的交互体验
  - 与AI问答和真题库智能联动

### 2. 内容管理员

- 负责上传和更新OPML格式的知识导图文件
- 审核知识导图内容，确保准确性和完整性
- 处理用户反馈的内容问题

### 3. 系统管理员

- 监控知识导图功能的性能和稳定性
- 处理技术层面的问题和优化
- 管理用户访问权限和使用数据

## 界面设计要求

### 1. 导图选择界面

- **布局**：
  - 顶部为导航栏，显示当前位置（如"知识导图"）
  - 主体区域以卡片形式展示各学科选项
  - 免费用户看到非"民法"学科时，卡片上有"会员专享"标识

- **卡片设计**：
  - 每个学科一张卡片，包含学科名称和简短描述
  - 使用统一的视觉样式，可适当使用代表性图标
  - 会员专享卡片使用半透明效果或锁图标标识
  - 鼠标悬停时有轻微动效，增强交互感

- **响应式设计**：
  - 在不同屏幕尺寸下自适应调整卡片布局
  - 移动端采用单列卡片布局，桌面端采用多列网格布局

### 2. 导图展示界面

- **布局结构**：
  - 顶部工具栏：包含返回按钮、当前学科名称、操作按钮（如缩放控制、全屏按钮）
  - 主体区域：显示知识导图内容
  - 底部状态栏（可选）：显示当前缩放比例、节点总数等信息

- **导图节点设计**：
  - 根节点（学科名称）使用最大尺寸，突出显示
  - 一级节点（主要章节）次之，使用中等尺寸
  - 二级及以下节点使用较小尺寸，但确保可读性
  - 节点间连线使用平滑曲线，颜色与整体设计协调
  - 未展开的节点使用+号标识，已展开节点使用-号标识

- **高亮与焦点设计**：
  - 当前选中节点使用主题色高亮显示
  - 智能联动定位的知识点使用特殊颜色或动画效果突出
  - 相关知识点可使用渐变色或轮廓线标识其关联性

- **操作控件**：
  - 缩放控制：+/-按钮或滑块控制整体缩放
  - 重置视图按钮：快速回到默认视图
  - 全屏切换按钮：支持全屏模式查看
  - 搜索输入框：快速定位特定知识点

### 3. 会员提示设计

- **非会员访问限制提示**：
  - 免费用户尝试访问会员专享学科时，显示友好的提示弹窗
  - 弹窗包含会员权益简介和升级按钮
  - 设计风格与整体UI保持一致，避免过于强硬的销售感

- **智能联动权限提示**：
  - 免费用户尝试使用智能联动功能时，展示温和的权限提示
  - 可展示功能预览或演示，吸引用户升级

### 4. 响应式设计

- **桌面端**：
  - 横向树状结构，充分利用宽屏空间
  - 支持快捷键操作，如方向键导航、+/-缩放等

- **平板端**：
  - 自适应缩放，确保整体导图可见
  - 优化触摸操作，增大点击区域

- **移动端**：
  - 考虑垂直树状布局，更适合窄屏设备
  - 简化部分控件，突出核心功能
  - 优化手势操作，支持双指缩放、滑动平移等

## 技术实现要点

### 1. 前端技术

- **框架**：React.js
- **导图渲染**：React-D3-Tree
- **状态管理**：Redux管理导图状态和用户交互
- **样式处理**：Styled-components或Less/Sass
- **动画效果**：React-Spring提供平滑过渡动画
- **响应式支持**：FlexBox和CSS Grid布局
- **性能优化**：虚拟滚动技术处理大型导图

### 2. 后端技术

- **框架**：Node.js + Express.js
- **OPML解析**：使用XML解析库处理OPML格式
- **数据处理**：建立知识点索引和关联关系
- **API设计**：RESTful API提供导图数据和操作接口

### 3. 数据存储

- **文件存储**：OPML文件存储在文件系统或对象存储服务
- **关系型数据库**：MySQL存储导图元数据和版本信息
- **缓存层**：Redis缓存热门导图数据，提升访问速度

### 4. 性能优化

- **数据分块**：大型导图数据分块加载，避免一次传输大量数据
- **懒加载**：按需加载导图节点，初始只加载可见区域
- **预渲染**：常用导图视图预渲染，减少计算负担
- **资源压缩**：导图数据传输前进行压缩，减少网络负载

## 安全与测试

### 1. 安全措施

- **访问控制**：严格验证用户权限，防止未授权访问
- **内容保护**：防止知识导图内容被批量爬取或复制
- **数据隔离**：确保用户间数据隔离，防止信息泄露

### 2. 测试计划

- **功能测试**：验证基本导图展示、交互和联动功能
- **性能测试**：测试大型导图加载性能和响应速度
- **兼容性测试**：在不同设备和浏览器中验证兼容性
- **用户体验测试**：邀请目标用户测试，收集操作流畅度和理解度反馈

## 未来扩展计划

1. **个性化标记**：
   - 用户可在导图上添加个人标记和笔记
   - 支持导图节点的收藏功能

2. **协作功能**：
   - 用户间共享导图笔记和标记
   - 讨论特定知识点的学习论坛

3. **导图导出**：
   - 支持导出为PDF、图片等格式
   - 支持选择性导出部分知识点

4. **知识点关系可视化**：
   - 增加知识点间关联关系的可视化
   - 构建法考知识网络图谱 