# 导图搜索优化方案

## 功能说明

为了让导图搜索更符合用户预期，现在实现了智能关键词提取功能：

### 1. 使用 DeepSeek API 智能判断
- 创建了新的 API 端点：`/api/ai/extract-single-keyword`
- 使用 AI 分析用户问题，提取最精确的搜索关键词
- 温度设置为 0.1，确保结果稳定

### 2. 关键词提取策略
- **精确匹配优先**：如"有偿合同"、"合同的保全"等具体概念，直接返回原词
- **智能概括**：对于抽象问题，AI 会提取核心法律概念
- **单个关键词**：只返回一个最精确的关键词，避免搜索结果过于宽泛

### 3. 降级方案
如果 AI API 调用失败，使用本地规则：
- 维护精确法律术语列表
- 按长度排序，优先匹配更长的术语
- 提取问题中最长的有意义词汇

## 示例

| 用户输入 | 提取的关键词 | 说明 |
|---------|------------|------|
| 有偿合同 | 有偿合同 | 精确匹配 |
| 合同的保全 | 合同的保全 | 精确匹配 |
| 承揽合同 | 承揽合同 | 精确匹配 |
| 离婚考点 | 离婚 | 提取核心概念 |
| 什么是正当防卫的条件 | 正当防卫 | 提取核心法律术语 |

## 技术实现

### API 调用流程
```javascript
1. 用户点击"查看导图"按钮
2. 调用 /api/ai/extract-single-keyword
3. AI 分析问题，返回最合适的关键词
4. 使用关键词进行导图搜索
5. 如果 API 失败，降级到本地规则提取
```

### 本地规则库
已包含以下类别的精确术语：
- 合同分类：有偿合同、无偿合同、双务合同等
- 合同制度：合同的保全、代位权、撤销权等
- 具体合同：承揽合同、买卖合同、租赁合同等
- 其他法律概念：正当防卫、犯罪构成、侵权责任等

## 优势

1. **更精确的搜索结果**：避免返回过于宽泛的结果
2. **符合用户预期**：用户搜索什么就显示什么
3. **智能化处理**：AI 能理解用户意图，提取最合适的关键词
4. **可靠的降级方案**：即使 AI 不可用，也能提供良好的搜索体验

## 后续优化建议

1. 根据用户使用情况，不断完善本地术语库
2. 记录搜索日志，分析用户搜索习惯
3. 考虑添加同义词映射，提高搜索召回率