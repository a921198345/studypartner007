# 宝塔服务器部署指令

## 1. 连接到服务器并进入项目目录
```bash
ssh root@你的服务器IP
cd /www/wwwroot/law-exam-assistant
```

## 2. 拉取最新代码
```bash
git pull origin main
```

## 3. 清理缓存并重新安装依赖
```bash
# 清理npm缓存
npm cache clean --force

# 删除旧的node_modules和.next
rm -rf node_modules
rm -rf .next

# 重新安装依赖
npm install
```

## 4. 构建项目
```bash
npm run build
```

## 5. 启动项目
```bash
# 停止之前的PM2进程（如果有）
pm2 stop law-exam-assistant 2>/dev/null || true
pm2 delete law-exam-assistant 2>/dev/null || true

# 启动新的PM2进程
pm2 start npm --name "law-exam-assistant" -- start

# 保存PM2配置
pm2 save
pm2 startup
```

## 6. 检查状态
```bash
# 检查PM2状态
pm2 status

# 查看日志
pm2 logs law-exam-assistant
```

## 7. 验证部署
访问你的域名，检查网站是否正常运行。

## 如果遇到问题：

### 清理所有缓存
```bash
rm -rf node_modules .next package-lock.json
npm cache clean --force
npm install
npm run build
```

### 检查端口占用
```bash
lsof -i :3000
```

### 重启PM2
```bash
pm2 restart all
```

## 注意事项
- 确保Node.js版本为v18+
- 确保有足够的磁盘空间
- 构建过程可能需要几分钟时间
- 如果构建失败，检查error.log文件
