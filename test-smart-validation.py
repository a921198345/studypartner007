#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
测试智能验证逻辑
验证修复后的效果
"""

import sys
sys.path.append('.')

from parse_questions_web import validate_question_format, parse_question

# 测试用例
test_cases = [
    {
        "name": "题号【20120276】",
        "text": """【20120276】 执法为民是社会主义法治的本质要求，行政机关 和公务员在行政执法中应当自觉践行。下列哪些做法 直接体现了执法为民理念： 
A．行政机关将行政许可申请书格式文本的费用由 2 元降为 1 元 
B．行政机关安排工作人员主动为前来办事的人员 提供咨询 
C ．工商局要求所属机构提高办事效率，将原 20 工作日办结事项减至 15 工作日办结 
D．某区设立办事大厅，要求相关执法部门进驻并 设立
【解析】
选项 A 错误。某县公安局发布的通知是针对社会不特定对象发布的，可反复适用的规定，因此是抽象行政行为。
选项 B 错误。行政指导行为是行政机关以倡导、示范、建议、咨询等方式， 引导公民自愿配合而达到行政管理目的的行为，属于非权力行政方式，行政指导的最大特征之一是非强制性。要求 10 名骑动车所有人学习交通法规 5 日的行为具有强制性，故属于行政命令。
选项 C 正确。《行政处罚法》第 8 条规定，行政处罚的种类：（1）警告；（2）罚款；（3）没收违法所得、没收非法财物；（4）责令停产停业；（5）暂扣或者吊销许可证、暂扣或者吊销执照；（6）行政拘留；（7）法律、行政法规规定的其他行政处罚。本题中，"暂扣行驶证、驾驶证 6 个月"属于对违法行为人的制裁和惩戒，性质上属于行政处罚中的行为罚，剥夺或者限制违法行为人从事某种行为的能力或资格。注意，"暂扣行驶证、驾驶证 6 个月"与【20120299】中"扣留驾驶证"性质不同，前者附加了明确的期限，属于行政处罚，后者未附加明确的期限，属于暂时性的强制措施。
选项 D 错误。《行政强制法》第 9 条规定，行政强制措施的种类
答案：C"""
    },
    {
        "name": "题号【20120299】跨页题目",
        "text": """【20120299】中"扣留驾驶证"性质不 同，前者附加了明确的期限，属于行政处罚，后者未 附加明确的期限，属于暂时性的强制措施。 
选项 D 错误。《行政强制法》第 9 条规定，行政强 制措施的种类：①限制公民人身自由；②查封场所、 设施或者财物；③扣押财物；④冻结存款、汇款；⑤ 其他行政强制措施。第 12 条规定，行政强制执行的方 式：①加处罚款或者滞纳金；②划拨存款、汇款；③ 拍卖或者依法处
A. 选项内容
B. 选项内容
C. 选项内容
D. 选项内容
【解析】根据相关法律规定，本题答案为D。"""
    },
    {
        "name": "题号【201801100】非8位题号",
        "text": """【201801100】题干内容
A. 选项A
B. 选项B
C. 选项C
D. 选项D
【解析】根据分析，正确答案是B。"""
    },
    {
        "name": "题号【20140245】跨页答案",
        "text": """【20140245】题干内容
A. 选项A内容
B. 选项B内容
C. 选项C内容
D. 选项D内容
【解析】根据行政处罚法第18条规定，行政机关实施行政强制措施应当遵守下列规定：①实施前须向行政机关负责人报告并经批准；②由2名以上行政执法人员实施；③出示执法身份证件；④通知当事人到场；⑤当场告知当事人采取行政强制措施的理由、依据以及当事人依法享有的权利、救济途径；⑥听取当事人的陈述和申辩；⑦制作现场笔录；⑧现场笔录由当事人和行政执法人员签名或者盖章，当事人拒绝的，在笔录中予以注明；⑨当事人不在场的，邀请见证人到场，由见证人和行政执法人员在现场笔录上签名或者盖章；⑩法律、法规规定的其他程序。本题中，某公安交警局交通大队民警发现王某违反交通规则违章停车后，对王某交付书面告知书符合法律规定，所以A正确。
答案：A"""
    }
]

print("=" * 60)
print("测试智能验证逻辑")
print("=" * 60)

for test_case in test_cases:
    print(f"\n测试用例: {test_case['name']}")
    print("-" * 40)
    
    # 验证题目格式
    issues = validate_question_format(test_case['text'])
    
    if issues:
        print(f"验证结果: 发现{len(issues)}个问题")
        for issue in issues:
            print(f"  - {issue}")
    else:
        print("验证结果: ✓ 格式正确")
    
    # 尝试解析题目
    try:
        result = parse_question(test_case['text'])
        if result:
            print("解析结果: ✓ 成功")
            print(f"  题号: {result['question_id']}")
            print(f"  选项数: {len(result['options'])}")
            print(f"  答案: {result['correct_answer']}")
        else:
            print("解析结果: ✗ 失败")
    except Exception as e:
        print(f"解析结果: ✗ 出错 - {e}")

print("\n" + "=" * 60)
print("测试完成")