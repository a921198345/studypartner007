<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试思维导图集成</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .test-case {
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .test-case h3 {
            margin-top: 0;
            color: #1976d2;
        }
        button {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #1565c0;
        }
        .result {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
        }
        .link {
            color: #1976d2;
            text-decoration: none;
            word-break: break-all;
        }
        .link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>测试思维导图集成功能</h1>
    
    <div class="test-section">
        <h2>1. 测试关键词提取</h2>
        <div class="test-case">
            <h3>测试用例：从问题中提取关键词</h3>
            <p>输入问题：什么是民法中的无因管理？请详细解释其构成要件。</p>
            <button onclick="testKeywordExtraction()">测试关键词提取</button>
            <div id="keyword-result" class="result"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>2. 测试URL生成</h2>
        <div class="test-case">
            <h3>测试用例：生成带搜索参数的URL</h3>
            <button onclick="testURLGeneration('civil', '无因管理 构成要件')">民法 - 无因管理</button>
            <button onclick="testURLGeneration('criminal', '正当防卫 限度')">刑法 - 正当防卫</button>
            <button onclick="testURLGeneration('administrative', '行政许可 条件')">行政法 - 行政许可</button>
            <div id="url-result" class="result"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>3. 测试导航跳转</h2>
        <div class="test-case">
            <h3>测试用例：直接跳转到思维导图页面</h3>
            <p>点击下面的链接测试跳转功能：</p>
            <div id="navigation-links"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>4. 集成测试场景</h2>
        <div class="test-case">
            <h3>场景1：从AI问答跳转到思维导图</h3>
            <p>模拟用户提问："什么是合同的效力？"</p>
            <button onclick="simulateAIChat()">模拟完整流程</button>
            <div id="integration-result" class="result"></div>
        </div>
    </div>

    <script>
        // 测试关键词提取
        function testKeywordExtraction() {
            const message = "什么是民法中的无因管理？请详细解释其构成要件。";
            
            // 模拟MindMapButton中的关键词提取逻辑
            const keywords = message
                .replace(/[？?。，！、：；""''（）《》【】]/g, ' ')
                .split(' ')
                .filter(word => word.length > 1)
                .slice(0, 5)
                .join(' ')
                .substring(0, 30);
            
            const result = `原始问题：${message}
提取的关键词：${keywords}
关键词长度：${keywords.length} 字符`;
            
            document.getElementById('keyword-result').textContent = result;
            document.getElementById('keyword-result').className = 'result success';
        }

        // 测试URL生成
        function testURLGeneration(subject, keywords) {
            const searchParams = new URLSearchParams({
                subject: subject,
                search: keywords
            });
            
            const url = `/knowledge-map?${searchParams.toString()}`;
            const fullUrl = window.location.origin + url;
            
            const result = `科目：${subject}
搜索关键词：${keywords}
生成的URL：${url}
完整URL：${fullUrl}`;
            
            document.getElementById('url-result').innerHTML = result;
            document.getElementById('url-result').className = 'result success';
            
            // 更新导航链接
            updateNavigationLinks(subject, keywords, fullUrl);
        }

        // 更新导航链接
        function updateNavigationLinks(subject, keywords, url) {
            const linksContainer = document.getElementById('navigation-links');
            linksContainer.innerHTML = `
                <p><strong>${subject} - ${keywords}</strong></p>
                <a href="${url}" target="_blank" class="link">${url}</a>
                <br><br>
                <button onclick="window.open('${url}', '_blank')">在新标签页打开</button>
                <button onclick="window.location.href='${url}'">在当前页面打开</button>
            `;
        }

        // 模拟AI聊天流程
        function simulateAIChat() {
            const steps = [
                "1. 用户提问：什么是合同的效力？",
                "2. AI回答完成，显示操作按钮",
                "3. 用户点击'在导图中查找'按钮",
                "4. 弹出科目选择对话框",
                "5. 用户选择'民法'",
                "6. 系统提取关键词：合同 效力",
                "7. 生成URL：/knowledge-map?subject=civil&search=合同%20效力",
                "8. 跳转到思维导图页面",
                "9. 思维导图自动搜索并高亮相关节点"
            ];
            
            let result = "完整流程模拟：\n\n";
            steps.forEach((step, index) => {
                result += step + "\n";
            });
            
            // 生成最终URL
            const finalUrl = window.location.origin + "/knowledge-map?subject=civil&search=合同%20效力";
            result += `\n最终生成的URL：\n${finalUrl}`;
            
            document.getElementById('integration-result').innerHTML = result + `
                <br><br>
                <button onclick="window.open('${finalUrl}', '_blank')">测试跳转</button>
            `;
            document.getElementById('integration-result').className = 'result success';
        }

        // 页面加载时自动运行一些测试
        window.onload = function() {
            // 显示一些预设的导航链接
            const presetLinks = [
                { subject: 'civil', keywords: '民法 合同', label: '民法 - 合同' },
                { subject: 'criminal', keywords: '刑法 犯罪', label: '刑法 - 犯罪' },
                { subject: 'administrative', keywords: '行政法 处罚', label: '行政法 - 处罚' }
            ];
            
            let linksHtml = '<h4>预设测试链接：</h4>';
            presetLinks.forEach(link => {
                const url = `/knowledge-map?subject=${link.subject}&search=${encodeURIComponent(link.keywords)}`;
                linksHtml += `<p><a href="${url}" target="_blank" class="link">${link.label}: ${url}</a></p>`;
            });
            
            document.getElementById('navigation-links').innerHTML = linksHtml;
        };
    </script>
</body>
</html>