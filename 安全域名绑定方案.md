# å®å¡”é¢æ¿å®‰å…¨åŸŸåç»‘å®šæ–¹æ¡ˆ

## âš ï¸ é‡è¦è­¦å‘Š
**ç»å¯¹ä¸è¦ç›´æ¥åœ¨å®å¡”é¢æ¿çš„Node.jsé¡¹ç›®ç®¡ç†ä¸­ç»‘å®šåŸŸåï¼è¿™ä¼šå¯¼è‡´é¢æ¿æ— æ³•è®¿é—®ï¼**

## ğŸ“‹ æ­£ç¡®çš„åŸŸåç»‘å®šæµç¨‹

### ç¬¬ä¸€æ­¥ï¼šç¡®ä¿åº”ç”¨æ­£å¸¸è¿è¡Œ
```bash
# 1. ç¡®è®¤åº”ç”¨å·²å¯åŠ¨
curl http://localhost:8080

# 2. ç¡®è®¤ç«¯å£ç›‘å¬æ­£å¸¸  
netstat -tlnp | grep :8080

# 3. å¦‚æœä½¿ç”¨PM2ï¼Œç¡®è®¤è¿›ç¨‹çŠ¶æ€
pm2 status law-exam-assistant
```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºç½‘ç«™ï¼ˆä¸æ˜¯Node.jsé¡¹ç›®ï¼‰
åœ¨å®å¡”é¢æ¿æ“ä½œï¼š
1. ç‚¹å‡» `ç½‘ç«™` -> `æ·»åŠ ç«™ç‚¹`
2. å¡«å†™ä¿¡æ¯ï¼š
   - **åŸŸå**: `your-domain.com`ï¼ˆä½ çš„å®é™…åŸŸåï¼‰
   - **æ ¹ç›®å½•**: `/www/wwwroot/law-exam-assistant-web` ï¼ˆæ–°å»ºç©ºç›®å½•ï¼‰
   - **FTP**: ä¸åˆ›å»º
   - **æ•°æ®åº“**: ä¸åˆ›å»º  
   - **PHPç‰ˆæœ¬**: `çº¯é™æ€`

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®åå‘ä»£ç†
1. è¿›å…¥åˆšåˆ›å»ºçš„ç½‘ç«™è®¾ç½®é¡µé¢
2. ç‚¹å‡» `åå‘ä»£ç†` æ ‡ç­¾é¡µ
3. ç‚¹å‡» `æ·»åŠ åå‘ä»£ç†`
4. å¡«å†™é…ç½®ï¼š
   - **ä»£ç†åç§°**: `law-exam-assistant`
   - **ç›®æ ‡URL**: `http://127.0.0.1:8080`
   - **å‘é€åŸŸå**: `$host`
   - **å†…å®¹æ›¿æ¢**: ä¸å¡«å†™

### ç¬¬å››æ­¥ï¼šé«˜çº§åå‘ä»£ç†é…ç½®
å¦‚æœéœ€è¦æ›´ç²¾ç¡®çš„æ§åˆ¶ï¼Œåœ¨ç½‘ç«™è®¾ç½®çš„ `é…ç½®æ–‡ä»¶` ä¸­æ·»åŠ ï¼š

```nginx
location / {
    proxy_pass http://127.0.0.1:8080;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_cache_bypass $http_upgrade;
    proxy_read_timeout 300s;
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    
    # å¤„ç†WebSocketè¿æ¥
    proxy_set_header Sec-WebSocket-Extensions $http_sec_websocket_extensions;
    proxy_set_header Sec-WebSocket-Key $http_sec_websocket_key;
    proxy_set_header Sec-WebSocket-Protocol $http_sec_websocket_protocol;
    proxy_set_header Sec-WebSocket-Version $http_sec_websocket_version;
}

# é™æ€èµ„æºç¼“å­˜ä¼˜åŒ–
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    proxy_pass http://127.0.0.1:8080;
    proxy_set_header Host $host;
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

### ç¬¬äº”æ­¥ï¼šSSLè¯ä¹¦é…ç½®
1. åœ¨ç½‘ç«™è®¾ç½®ä¸­ç‚¹å‡» `SSL` æ ‡ç­¾é¡µ
2. é€‰æ‹© `Let's Encrypt` å…è´¹è¯ä¹¦
3. å¡«å†™é‚®ç®±åœ°å€ï¼Œå‹¾é€‰åŸŸå
4. ç‚¹å‡» `ç”³è¯·` æŒ‰é’®
5. ç­‰å¾…è¯ä¹¦ç”³è¯·å®Œæˆ
6. å¼€å¯ `å¼ºåˆ¶HTTPS`

### ç¬¬å…­æ­¥ï¼šé˜²ç«å¢™å’Œå®‰å…¨è®¾ç½®
1. åœ¨å®å¡”é¢æ¿ `å®‰å…¨` é¡µé¢ï¼š
   - **æ”¾è¡Œç«¯å£**: 443(HTTPS), 80(HTTP)
   - **ç¦æ­¢ç›´æ¥è®¿é—®**: 8080ç«¯å£ï¼ˆä»…å†…ç½‘è®¿é—®ï¼‰

2. æœåŠ¡å™¨é˜²ç«å¢™é…ç½®ï¼š
```bash
# å¦‚æœä½¿ç”¨ ufw
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw deny 8080/tcp

# å¦‚æœä½¿ç”¨ firewalld  
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --permanent --remove-port=8080/tcp
firewall-cmd --reload
```

## ğŸ”§ åŸŸåç»‘å®šåéªŒè¯

### éªŒè¯æ­¥éª¤
```bash
# 1. æ£€æŸ¥DNSè§£æ
nslookup your-domain.com

# 2. æ£€æŸ¥HTTPè®¿é—®
curl -I http://your-domain.com

# 3. æ£€æŸ¥HTTPSè®¿é—®  
curl -I https://your-domain.com

# 4. æ£€æŸ¥åº”ç”¨åŠŸèƒ½
curl https://your-domain.com/api/health
```

### å¸¸è§é—®é¢˜æ’æŸ¥
1. **åŸŸåæ— æ³•è®¿é—®**ï¼š
   - æ£€æŸ¥DNSè§£ææ˜¯å¦ç”Ÿæ•ˆ
   - ç¡®è®¤åå‘ä»£ç†é…ç½®æ­£ç¡®
   - æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—

2. **SSLè¯ä¹¦é—®é¢˜**ï¼š
   - é‡æ–°ç”³è¯·è¯ä¹¦
   - æ£€æŸ¥åŸŸåæŒ‡å‘æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤80ç«¯å£å¯è®¿é—®

3. **åº”ç”¨åŠŸèƒ½å¼‚å¸¸**ï¼š
   - æ£€æŸ¥Node.jsåº”ç”¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
   - æŸ¥çœ‹åº”ç”¨æ—¥å¿—
   - ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸

## ğŸš¨ ç´§æ€¥æ¢å¤æ–¹æ¡ˆ

å¦‚æœåŸŸåç»‘å®šå¯¼è‡´é—®é¢˜ï¼š

### æ–¹æ¡ˆä¸€ï¼šé€šè¿‡SSHæ¢å¤
```bash
# 1. SSHè¿æ¥æœåŠ¡å™¨
ssh root@your-server-ip

# 2. å¤‡ä»½å½“å‰é…ç½®
cp /www/server/panel/vhost/nginx/your-domain.com.conf /tmp/backup.conf

# 3. åˆ é™¤é—®é¢˜é…ç½®
rm /www/server/panel/vhost/nginx/your-domain.com.conf

# 4. é‡å¯Nginx
systemctl restart nginx

# 5. é€šè¿‡IPé‡æ–°è®¿é—®å®å¡”é¢æ¿
http://your-server-ip:8888
```

### æ–¹æ¡ˆäºŒï¼šé€šè¿‡å®å¡”å‘½ä»¤è¡Œå·¥å…·
```bash
# åˆ é™¤ç½‘ç«™
/www/server/panel/pyenv/bin/python /www/server/panel/tools.py panel deletesite your-domain.com

# é‡å¯é¢æ¿æœåŠ¡
systemctl restart bt
```

## ğŸ“ é…ç½®æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåè¯·é€é¡¹æ£€æŸ¥ï¼š

- [ ] Node.jsåº”ç”¨åœ¨8080ç«¯å£æ­£å¸¸è¿è¡Œ
- [ ] å®å¡”é¢æ¿å¯ä»¥æ­£å¸¸è®¿é—®  
- [ ] ç½‘ç«™å·²åˆ›å»ºï¼ˆéNode.jsé¡¹ç›®ç±»å‹ï¼‰
- [ ] åå‘ä»£ç†é…ç½®æ­£ç¡®
- [ ] åŸŸåDNSè§£ææŒ‡å‘æœåŠ¡å™¨IP
- [ ] SSLè¯ä¹¦ç”³è¯·å¹¶å¯ç”¨æˆåŠŸ
- [ ] é˜²ç«å¢™è§„åˆ™é…ç½®æ­£ç¡®
- [ ] HTTPå’ŒHTTPSéƒ½èƒ½æ­£å¸¸è®¿é—®
- [ ] åº”ç”¨æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

## ğŸ¯ æœ€ä½³å®è·µå»ºè®®

1. **åˆ†æ­¥éª¤æ“ä½œ**ï¼šä¸€æ­¥ä¸€æ­¥æ¥ï¼Œæ¯æ­¥éªŒè¯åå†è¿›è¡Œä¸‹ä¸€æ­¥
2. **å…ˆæµ‹è¯•åéƒ¨ç½²**ï¼šåœ¨æµ‹è¯•åŸŸåä¸Šå…ˆéªŒè¯æµç¨‹
3. **å¤‡ä»½é…ç½®**ï¼šé‡è¦æ“ä½œå‰å…ˆå¤‡ä»½ç›¸å…³é…ç½®æ–‡ä»¶
4. **ç›‘æ§æ—¥å¿—**ï¼šéƒ¨ç½²è¿‡ç¨‹ä¸­æŒç»­ç›‘æ§åº”ç”¨å’ŒNginxæ—¥å¿—
5. **å‡†å¤‡å›æ»š**ï¼šå‡ºé—®é¢˜æ—¶èƒ½å¿«é€Ÿå›æ»šåˆ°ä¹‹å‰çŠ¶æ€

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š`pm2 logs law-exam-assistant`
2. æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—ï¼š`tail -f /www/wwwlogs/your-domain.com.error.log`
3. æŸ¥çœ‹å®å¡”é¢æ¿æ—¥å¿—ï¼š`tail -f /www/server/panel/logs/error.log`

è®°ä½ï¼š**å®‰å…¨ç¬¬ä¸€ï¼Œç¨³å®šè¿è¡Œæ¯”åŠŸèƒ½é½å…¨æ›´é‡è¦ï¼**